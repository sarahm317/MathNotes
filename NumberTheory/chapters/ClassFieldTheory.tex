\setchapterstyle{kao}
\setchapterpreamble[u]{\margintoc}
\chapter{Class Field Theory}
\labch{classFieldTheory}


\begin{definition}[Local field]
    \labdef{local-field}
    A local field is a field $K$ with a nontrivial absolute value $|\cdot|$ such that $K$ is locally compact with respect to $|\cdot|$.
\end{definition}

Requiring that $K$ is locally compact with respect to $|\cdot|$ implies that $K$ is complete with respect to $|\cdot|$. If $K = \R$ or $K = \C$, then $K$ is an archimedean local field. If the corresponding $|\cdot|$ has a discrete valuation with finite residue class field, then $K$ is a nonarchimedean local field.

\begin{definition}[Global field]
    \labdef{global-field}
    A global field is either:

    \begin{enumerate}[(1)]
        \item An algebraic number field.
        \item A function field in one variable over a finite field.
    \end{enumerate}
\end{definition}

A number field is always characteristic zero as it is defined as an extension over $\Q$. If the function field of an algebraic curve is taken over a finite field, it is the same as viewing it as a finite extension of some $\F_p(t)$ which is of nonzero (prime) characteristic.

\begin{proposition}
    A local field is the completion of some global field with respect to an absolute value.
\end{proposition}

Class field theory describes relationships between the abelian extensions of a number field $K$ and the structure of $\mathcal{O}_{K}$.

\begin{definition}[Unramified abelian extension]
    A maximal unramified abelian extension of $K$ is an extension $L$ that is unramified at all primes and every real embedding $K \hookrightarrow \R$ extends to a real embedding $L \hookrightarrow \R$.
\end{definition}

\marginnote{Not sure exactly what was being defined here... Should revist later.}

\begin{theorem}
    \labthm{class-group-galois-group}
    Let $L$ be a maximal unramified abelian extension of $K$. Then there exists a canonical isomorphism

    \[\textrm{Cl}(K)\xrightarrow{\cong} \textrm{Gal}(L/K).\]

\end{theorem}

The canonical isomorphism in \refthm{class-group-galois-group} can be described as follows:

Consider the diagram:

    \[\begin{tikzcd}[column sep=small]
        \label{setup}
        L & \lar[dash, "\supseteq"'] \mathcal{O}_{L} & \lar[dash, "\supseteq"']\wp\\
        K \uar[dash] & \lar[dash, "\supseteq"']\mathcal{O}_{K} &\lar[dash, "\supseteq"']\mathfrak{p}
    \end{tikzcd}\]
where $\wp$ is a nonzero prime ideal of $\mathcal{O}_{L}$ and $\mathfrak{p} = \wp \cap \mathcal{O}_{K}$. Define $\lambda = \mathcal{O}_{L}/\wp$ and $\kappa = \mathcal{O}_{K}/\mathfrak{p}$. There exists a natural map
    \[G_\wp \to \textrm{Aut}(\lambda/\kappa)\]
If $\sigma \in G_\wp \sq \textrm{Gal}(L/K)$ then $\sigma(\wp) = \wp$ (and in particular, $\sigma(\mathfrak{p}) = \mathfrak{p})$. Define an element $\varphi_\sigma$ of $\textrm{Aut}(\lambda/\kappa)$ by
    \[\varphi_\sigma: x + \wp \mapsto \sigma(x) + \wp\]
noting that this map is well-defined since $\wp$ is fixed by $\sigma$. Furthmore, as $\sigma$ fixes elements in $K$, $\varphi_\sigma$ fixes elements of $\kappa$. Therefore, the map $G_\wp \to \textrm{Aut}(\lambda/\kappa)$ given by $\sigma \mapsto \varphi_\sigma$ is as desired.


If $K_1/K$ and $K_2/K$ are both unramified abelian extensions, then $K_1K_2/K$ is an unramified abelian extension (see \refthm{subextensions-are-unramified}). This means that the maximal unramified abelian extension of $K$ can be well defined as the composition of all unramified abelian extensions of $K$.

\begin{definition}[Hilbert class field]
    \labdef{hilbert-class-field}
    Let $K$ be a number field. The maximal unramified abelian extension of $K$ is called the Hilbert class field.
\end{definition}

Assuming the same notation and set up as \ref{setup}, we have the following result:

\begin{proposition}
    \labprop{unramified-criterion}
    An extension $L/K$ is unramified if and only if the natural map $G_\wp \to \textrm{Aut}(\lambda/\kappa)$ is an isomorphism.
\end{proposition}
\marginnote{
    Need to add more details for the proof here -- a lot is missing.}
\begin{proof}
    Note that $\mathfrak{p} \mathcal{O}_{L}$ has a unique factorization of the form:

    \[\mathfrak{p}\mathcal{O}_{L} = \wp_1^{e_1}\cdots \wp_r^{e_r}\]

    with $\wp_1 = \wp$. Consider the following two facts:

    \begin{enumerate}[(1)]
        \item $[L:K] = \sum_{j=1}^r e(\wp_j/\mathfrak{p})f(\wp_j/\mathfrak{p})$.
        \item The Galois group $\textrm{Gal}(L/K)$ acts transitively on the collection $\{\wp_1, \ldots, \wp_r\}$. 
    \end{enumerate}
    Fact (2) means that there is a bijection between $\{\wp_1, \ldots, \wp_r\}$ and the $G_\wp$-cosets in $\textrm{Gal}(L/K)$. That is,
        \[r = \frac{|\textrm{Gal}(L/K)}{|G_\wp|} = \frac{[L:K]}{|G_\wp|}.\]

        \marginnote{I'm confused on the first couple lines of the proof here. Why do we know that the ramification indexes are all equal? How does transitivity give a relationship to the $G_\wp$ cosets in $\textrm{Gal}(L/K)$?}
    Combining this with fact (1) yields
        \[[L:K] = r \]
    and since $r = \frac{[L:K]}{|G_\wp|}$,
        \[|G_\wp| = e(\wp/\mathfrak{p})f(\wp/\mathfrak{p}) = e(\wp/\mathfrak{p})[\lambda:\kappa].\]
\end{proof}





Suppose that $\mathfrak{p}$ is unramified in  $L/K$. \refprop{unramified-criterion} implies that there is an isomorphism between $G_\wp$ and $\textrm{Gal}(\lambda/\kappa)$. The Galois group is cyclic and thus has a generator $\textrm{Fr}: \lambda \to \lambda$ where $\textrm{Fr}: x \mapsto x^{|\kappa|}$. This generator is called the \textbf{Frobenius element} and is denoted by $\textrm{Frob}_\wp$.\\

As the Galois group $\textrm{Gal}(L/K)$ acts transitively on the collection of prime ideals lying above $\mathfrak{p}$, given any $\wp' \sq \mathcal{O}_{L}$ lying above $\mathfrak{p}$, there exists $\sigma \in \textrm{Gal}(L/K)$ with $\wp' = \sigma(\wp)$. It can be verified that

\[\textrm{Frob}_{\wp'} = \sigma \textrm{Frob}_\wp\sigma\inv\]

meaning that $\textrm{Frob}_{\wp}$ and $\textrm{Frob}_{\wp'}$ are in the same conjugacy class in $\textrm{Gal}(L/K)$. This means that the following definition is well-defined:

\begin{definition}[Frobenius of $\mathfrak{p}$]
    \labdef{frobenius-of-p}
    Let $\mathfrak{p}$ and $\wp$ be nonzero prime ideals such that $\mathfrak{p} = \wp\cap \mathcal{O}_{K}$. The Frobenius of $\mathfrak{p}$, denoted by $\textrm{Frob}_{\mathfrak{p}}$, is the conjugacy class of $\textrm{Gal}(L/K)$ that contains $\textrm{Frob}_\wp$.
\end{definition}

When $L/K$ is an abelian extension, the conjugacy class is a single element. Therefore, instead of referring to the conjugacy class as the Frobenius of $\mathfrak{p}$, we refer to the element in the conjugacy class as the Frobenius of $\mathfrak{p}$. We maintain the same notation.

When $L/K$ is an unramified abelian extension, then the group homomorphism
    \[I_K \to \textrm{Gal}(L/K)\]
with
    \[\mathfrak{p} \mapsto \textrm{Frob}_{\mathfrak{p}}\]
is well-defined. This motivates the following theorem:

\begin{theorem}
    Suppose that $L$ is the maximal unramified abelian extension of $K$. Then the group homomorphism $I_K \to \textrm{Gal}(L/K)$ is surjective and has kernel $P_K$.
\end{theorem}

\begin{corollary}
    Let $\mathfrak{p}$ be a prime ideal of $K$ and $L$ the Hilbert class field of $K$. Then, $\mathfrak{p}$ splits in $L$ if and only if $\mathfrak{p}$ is a principal ideal.
\end{corollary}